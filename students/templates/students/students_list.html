{% extends "students/base.html" %}
{% load static %}
{% load pagenav %}
{% block meta_title %}Студенти{% endblock %}
{% block title %}База Студентів{% endblock %}

{% block content %}
    <form action="{% url 'students_multidel' %}" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {% if user.is_authenticated %}
        <a class="btn btn-primary mb-3" href="{% url 'students_add' %}" role="button">Add student</a>
    {% endif %}
                <!-- start students listing -->
                <table class="table table-hover table-striped">
                    {% with order_by=request.GET.order_by reverse=request.GET.reverse %}
                    <thead>
                        <tr>
                            <th style="width:3%"><a href="{% url 'students_list' %}?order_by=id{% if order_by == 'id' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                #
                                {% if order_by == 'id'  and reverse != '1' %}&uarr;
                                {% elif order_by == 'id' and reverse == '1' %}&darr;
                                {% endif %}
                                </a>
                            </th>
                            <th style="width:7%">Photo</th>
                            <th style="width:20%"><a href="{% url 'students_list' %}?order_by=last_name{% if order_by == 'last_name' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                Last name
                                {% if order_by == 'last_name' and reverse != '1' or order_by == '' and reverse != '1' %}&uarr;
                                {% elif order_by == 'last_name' and reverse == '1' %}&darr;
                                {% endif %}
                                </a>
                            </th>
                            <th style="width:20%"><a href="{% url 'students_list' %}?order_by=first_name{% if order_by == 'first_name' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                First name
                                {% if order_by == 'first_name'  and reverse != '1' %}&uarr;
                                {% elif order_by == 'first_name' and reverse == '1' %}&darr;
                                {% endif %}
                                </a></th>
                            <th style="width:5%"><a href="{% url 'students_list' %}?order_by=ticket{% if order_by == 'ticket' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                Ticket
                                {% if order_by == 'ticket'  and reverse != '1' %}&uarr;
                                {% elif order_by == 'ticket' and reverse == '1' %}&darr;
                                {% endif %}
                                </a></th>
                            {% if user.is_authenticated %}
                                <th style="width:7%" >Actions</th>
                                <th style="width:3%"><input class="btn btn-secondary btn-sm" id="multidel_button" type="submit" value="Delete" name="multidel_button" disabled="disabled"></th>
                            {% endif %}
                        </tr>
                    </thead>
                    {% endwith %}

                    <tbody>
                        {% for student in students %}
                        <tr>
                            <td style="width:3%">{{ student.id }}</td>
                            <td style="width:7%">{% if student.photo %}
                                    <img height="35" width="35" class="rounded-circle" src="{{ student.photo.url }}"> </td>
                                {% else %}
                                    <img height="35" width="35" class="rounded-circle" src="{% static 'img/default.png' %}"> </td>
                                {% endif %}
                            <td style="width:30%"><a title="Редагувати" class="student-edit-form-link" href="{% url 'students_edit' student.id %}">{{ student.last_name }}</a></td>
                            <td style="width:30%"><a title="Редагувати" class="student-edit-form-link" href="{% url 'students_edit' student.id %}">{{ student.first_name }}</a></td>
                            <td style="width:5%">{{ student.ticket }}</td>
                            {% if user.is_authenticated %}
                                <td style="width:7%">
                                    <div class="dropdown">
                                         <a href="#" class="btn btn-primary  dropdown-toggle" data-bs-toggle="dropdown">
                                            Action</a>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="{% url 'students_edit' student.id %}">Edit</a>
                                            <a class="dropdown-item" href="{% url 'journal' student.id %}">Visiting</a>
                                            <a class="dropdown-item" href="{% url 'students_delete' student.id %}">Remove</a>
                                        </div>
                                    </div>
                                </td>
                                <td style="width:3%" class="multidel" >
                                    <input type="checkbox" value="{{ student.id }}" name="checks[]">
                                </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% pagenav object_list=students is_paginated=is_paginated paginator=paginator %}
                {% comment %}
                {% with object_list=students %}
                    {% include "students/pagination.html" %}
                {% endwith %}
                {% include 'students/pagination.html' %}

                {% if students.has_other_pages %}{% with order_by=request.GET.order_by reverse=request.GET.reverse %}
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="{% url 'students_list' %}?page=1&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">&laquo;</a>
                            </li>
                            {% for p in students.paginator.page_range %}
                                <li class="page-item {% if students.number == p %}active{% endif %}">
                                    <a class="page-link" href="{% url 'students_list' %}?page={{ p }}&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">{{ p }}</a>
                                </li>
                            {% endfor %}
                            <li class="page-item">
                                <a class="page-link" href="{% url 'students_list' %}?page={{ students.paginator.num_pages }}&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">&raquo;</a>
                            </li>
                        </ul>
                    </nav>
                {% endwith %}
                {% endif %}
 {% endcomment %}
    </form>
{% endblock %}
